/**
 * @version 1.0.0
 * @author fukuo <github.com/fukou>
 * @website https://fukuo.site
 */

var app={init:function(){app.buttonSuggestions(),app.postToggleButton(),app.sparkingEffect(),app.postNPF(),app.postSoundCloud(),app.postSpotify(),app.postBandCamp(),app.checkPhotoNPF(),app.shortenPost(),app.initCredit(),app.postNPFAudio(),app.postNPFData()},buttonSuggestions:()=>{let e=document.querySelector("button#tags");document.addEventListener("click",(function(t){e.contains(t.target)?e&&(e.classList.toggle("is-actived"),document.body.classList.toggle("is-suggestions-clicked"),document.querySelector(".wrapper__sidebar__search__suggestions").classList.toggle("is-shown")):(e.classList.remove("is-actived"),document.body.classList.remove("is-suggestions-clicked"),document.querySelector(".wrapper__sidebar__search__suggestions").classList.remove("is-shown"))}))},postToggleButton:()=>{document.querySelectorAll(".posts__dated__toggle button").forEach((function(e,t){document.addEventListener("click",(function(t){e.contains(t.target)?e.nextElementSibling&&e.nextElementSibling.classList.toggle("is-shown"):e.nextElementSibling.classList.remove("is-shown")}))}))},sparkingEffect:()=>{let e=function(){document.querySelectorAll(".sparkling").forEach((function(e){let o=e,n=o.querySelectorAll(".star");n.length>5&&n.forEach((function(e,t){0===t&&e.remove()})),o.insertAdjacentHTML("beforeend",t())}));let o=Math.round(700*Math.random())+100;setTimeout(e,o)},t=function(){let e=Math.floor(20*Math.random())+10;return'<span class="star" style="top:'+(Math.floor(100*Math.random())-50)+"%; left:"+Math.floor(100*Math.random())+'%;"><svg width="'+e+'" height="'+e+'" viewBox="0 0 68 68" fill="none"><path d="M26.5 25.5C19.0043 33.3697 0 34 0 34C0 34 19.1013 35.3684 26.5 43.5C33.234 50.901 34 68 34 68C34 68 36.9884 50.7065 44.5 43.5C51.6431 36.647 68 34 68 34C68 34 51.6947 32.0939 44.5 25.5C36.5605 18.2235 34 0 34 0C34 0 33.6591 17.9837 26.5 25.5Z" fill="#FFC700" /></svg></span>'};e()},postNPF:()=>{npfPhotosets(".posts",{includeCommonPhotosets:!0,useTumblrLightbox:!0,photosetMargins:"7.5"})},postSoundCloud:()=>{const e=document.querySelectorAll(".soundcloud_audio_player");e&&e.forEach((function(e,t){const o=e.getAttribute("src").split("&")[0],n="&amp;liking=false&amp;sharing=false&amp;auto_play=false&amp;show_comments=false&amp;continuous_play=false&amp;buying=false&amp;show_playcount=false&amp;show_artwork=true&amp;origin=tumblr&amp;color="+"#de8100".split("#")[1];e.setAttribute("src",o+n),e.setAttribute("height",116),e.parentElement.classList.add("is-soundcloud")}))},postSpotify:()=>{const e=document.querySelectorAll(".spotify_audio_player");e&&e.forEach((function(e,t){e.parentElement.classList.add("is-spotify")}))},postBandCamp:()=>{const e=document.querySelectorAll(".bandcamp_audio_player");if(e)for(b of e)b.parentElement.classList.add("is-bandcamp")},checkPhotoNPF:()=>{document.querySelectorAll(".posts").forEach((function(e,t){const o=e.querySelector(".npf_photoset"),n=e.querySelector(".reblog-list figure.tmblr-full:first-of-type");o?e.classList.add("posts-photoset-text"):n&&e.classList.add("posts-photo-text")}))},shortenPost:()=>{document.querySelector("body.is-shorten-long-post")&&document.querySelectorAll("article[class*='long_post']").forEach((function(e){let t=e.querySelector(".posts__body");if(null!=t&&t.clientHeight>=700){t.classList.add("is-truncated");const e=document.createElement("a");e.className="is-toggle btn btn__primary",e.textContent="Expand",e.href="#",t.append(e),e.addEventListener("click",(function(e){e.preventDefault(),t.classList.remove("is-truncated"),t.classList.add("is-truncated--full"),this.remove()}))}}))},initCredit:()=>{var e;document.querySelector(".footer__credit")||(e="is-removed-credit",document.body.classList.add(e),document.body.insertAdjacentHTML("beforeend",'\n      <div class="credits">\n        <div class="credits__inner">\n          <h2>This user has removed the credit link ðŸ¤¯</h2>\n          <p>The theme was originally created by <a href="https://fukuo.tumblr.com/">fukuo</a> on Tumblr. You can browse other themes <a href="https://www.tumblr.com/themes/">here</a>.</p>\n        </div>\n      </div>\n      '))},postNPFAudio:()=>{document.querySelectorAll(".posts").forEach(((e,t)=>{e.querySelectorAll("figcaption.audio-caption").forEach((e=>{e.parentElement.classList.add("tmblr-npf-audio"),e.parentElement.classList.remove("tmblr-full");const t=e.querySelector(".tmblr-audio-meta"),o=t?.querySelector(".title")?.textContent.trim(),n=t?.querySelector(".artist")?.textContent.trim(),s=t?.querySelector(".album")?.textContent.trim(),r=e?.querySelector(".album-cover")?.getAttribute("src");if(e.classList.add("d-none"),o||n||s||r){const t=document.createElement("section");t.className="posts__audio-npf";const a=[{selector:".title",className:"posts__audio-npf__title",textContent:o},{selector:".artist",className:"posts__audio-npf__artist",textContent:n},{selector:".album",className:"posts__audio-npf__album",textContent:s}],l=document.createElement("div");if(l.className="posts__audio-npf__cover",r){const e=document.createElement("img");e.src=r,e.alt="",l.appendChild(e)}else{const e=document.createElement("div");e.className="album-placeholder",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="5.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="15.5" r="2.5"/><path d="M8 17V5l12-2v12"/></svg>',l.appendChild(e)}const i=document.createElement("div");i.className="posts__audio-npf__details",a.forEach((({selector:e,className:t,textContent:o})=>{if(o){const n=document.createElement(e.startsWith(".")?"div":e);n.className=t,n.textContent=o,i.appendChild(n)}}));const c=document.createElement("button");c.className="posts__audio-npf__button",c.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <polygon points="5 3 19 12 5 21 5 3"></polygon>\n            </svg>\n          ';const p=e.parentElement.querySelector("audio");if(p&&(p.style.display="none",c.addEventListener("click",(()=>{p.paused||p.ended?(p.play(),c.innerHTML='\n                  <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <rect x="6" y="4" width="4" height="16"></rect>\n                    <rect x="14" y="4" width="4" height="16"></rect>\n                  </svg>\n                '):(p.pause(),c.innerHTML='\n                  <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                  </svg>\n                ')})),p.addEventListener("play",(()=>{c.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <rect x="6" y="4" width="4" height="16"></rect>\n                  <rect x="14" y="4" width="4" height="16"></rect>\n                </svg>\n              '})),p.addEventListener("pause",(()=>{c.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                </svg>\n              '})),p.addEventListener("ended",(()=>{c.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                  <polygon points="5 3 19 12 5 21 5 3"></polygon>\n                </svg>\n              '}))),i.prepend(c),t.append(i,l),e.parentElement.appendChild(t),p){const e=document.createElement("div");e.className="posts__audio-npf__progress-bar";const t=document.createElement("div");t.className="posts__audio-npf__progress-fill",e.appendChild(t),e.addEventListener("click",(t=>{const o=e.getBoundingClientRect(),n=(t.clientX-o.left)/o.width;p.currentTime=p.duration*n})),p.addEventListener("timeupdate",(()=>{const e=p.currentTime/p.duration*100;t.style.width=`${e}%`})),i.appendChild(e)}}}))}))},postNPFData:()=>{document.querySelectorAll(".posts").forEach((e=>{const t=e.getAttribute("data-article-npf"),o=app.extractJSONString(t),n=app.decodeAndReplace(o);try{const t=JSON.parse(n);if(t.trail){e.querySelectorAll(".reblog-list").forEach(((e,o)=>{let n=t.trail[o],s=(n?.layout.find((e=>"ask"===e.type)),n.blog),r=s.theme,a=(s.tumblrmart_accessories,s.tumblrmart_accessories?.badges),{description:l,title:i,name:c}=s,{link_color:p,title_font:d,title_color:u,background_color:m,header_image_scaled:g,avatar_shape:h}=r;if(s.can_show_badges&&a){let t,o,n=e.querySelector(".reblog-post-badges");n||(n=document.createElement("span"),n.className="reblog-post-badges",app.insertAfter(n,e.querySelector(".reblog-post-avatar-name"))),a[0].urls.forEach(((e,s)=>{t=document.createElement("img"),t.src=e,o=document.createElement("span"),o.className="reblog-post-badges-item",o.append(t),n.append(o),s>6&&n.classList.add("reblog-post-badges-huge")}))}if(n.content)for(let t=0;t<n.content.length;t++){const o=n.content[t];switch(o.type){case"poll":const t=app.formatDate(o.created_at),n=(app.convertEpochToRegularDate(o.timestamp),app.convertEpochToRegularDate(o.timestamp+o.settings.expire_after)),s=app.formatDate(n);let r;r=document.createElement("div"),r.className="poll-post-date",r.innerHTML=`<span class="poll-post-date__started"><b>Poll started on</b> ${t}</span>\n                                                  <span class="poll-post-date__ended"><b>Poll ended on</b> ${s} </span>\n                                                  `,e.querySelector(".poll-post").append(r);break;case"paywall":let a;const l=o.text.replace("%s",`<strong>${c}</strong>`);a=document.createElement("div"),a.className="reblog-list-paywall",a.innerHTML=`<h2 style="font-family:${d};">${o.title}</h2>\n                                                        <p>${l}</p>\n                                                        <p><a class="btn btn__secondary" href="${o.url}">Show your support!</a>\n                                                       `,a.style.setProperty("--link-color",p),a.style.setProperty("--background-color",m),a.style.setProperty("--title-color",u),e.append(a),a.previousElementSibling.remove()}}}))}}catch(e){console.error("Error parsing JSON:",e)}}))},decodeAndReplace:e=>e.replace(/\\x22/g,'"').replace(/\\x3c/g,"<").replace(/\\x3e/g,">").replace(/\\x26amp;/g,"&").replace(/\\x26/g,"&").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\"),extractJSONString(e){const t=e.indexOf("'")+1,o=e.lastIndexOf("'");return e.substring(t,o)},insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)},formatDate(e){const[t,o]=e.split(" "),[n,s,r]=t.split("-").map(Number),[a,l,i]=o.split(":").map(Number),c=new Date(n,s-1,r,a,l,i);if(isNaN(c.getTime()))return console.error("Invalid Date:",e),"";return c.toLocaleString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},convertEpochToRegularDate(e,t=!1){const o=new Date(1e3*e).toISOString().slice(0,19).replace("T"," ");return t?o+" GMT":o}};document.addEventListener("DOMContentLoaded",(()=>{app.init()}));